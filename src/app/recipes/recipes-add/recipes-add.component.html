<mat-expansion-panel>
    <mat-expansion-panel-header>
        <mat-panel-title>
            Add New Record
        </mat-panel-title>
    </mat-expansion-panel-header>
    <form [formGroup]="myForm">
        <mat-form-field>
            <input matInput placeholder="Record" formControlName="record">
        </mat-form-field>
        <mat-form-field>
            <input matInput placeholder="Details" formControlName="details">
        </mat-form-field>
        <mat-card>
            <mat-card-subtitle>
                Fields
            </mat-card-subtitle>
            <div formArrayName="fields">
                <div *ngFor="let field of fieldForms.controls; let i=index; last as isLast; first as isFirst" [formGroupName]="i">
                    <mat-form-field>
                        <input matInput placeholder="Field 1" formControlName="field1">
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput placeholder="Field 2" formControlName="field2">
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput placeholder="Field 3" formControlName="field3">
                    </mat-form-field>
                    <span class="button-row">
                        <button mat-mini-fab color="warn" (click)="deleteFields(i)" *ngIf="isFirst == false"><mat-icon>delete</mat-icon></button>
                        <button mat-mini-fab color="primary" (click)="addFields()" *ngIf="isLast"><mat-icon>add</mat-icon></button>
                    </span>
                </div>
            </div>
        </mat-card>
    </form>
    <br>
    <button mat-raised-button color="primary" (click)="writeForms()">Send Form</button>
</mat-expansion-panel>